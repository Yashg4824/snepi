<!DOCTYPE html>
<html>
<head>
    <title>DROUGHT MONITOR | SNEPI</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
</head>
<body>
    <nav>
        <img src="iitd.png" class="logo" alt="">
    
        <div class="navigation">
        <ul>
            <i id="menu-close" class="fas fa-times"></i>
            <li><a href="index.html">Home</a></li>
            <li><a href="">About Us</a></li>
            <li><a href="">Contact</a></li>
        </ul>
    
        <img src="img/menu.png" id="menu-btn" alt="">
        </div>
    </nav>

    <div id="map-container">
        <div id="map" style="height: 500px;"></div>
    </div>     
    <div id="image-container">
        <img src="colorbar.png" alt="" style="width: 50%;  display: block;
        margin-left: auto;
        margin-right: auto;"/>
    </div>

    <!-- Create the 3 dropdown menus -->
    <select id="timescale">
        <option value="snepi_1">Timescale 1</option>
        <option value="snepi_3">Timescale 2</option>
        <option value="snepi_6">Timescale 3</option>
        <option value="snepi_12">Timescale 4</option>
    </select>
     
    <input type="text" id="year" name="year" pattern="[0-9]{4}" title="Please enter a 4-digit year">
    

    <select id="month">
        <option value="01">January</option>
        <option value="02">February</option>
        <option value="03">March</option>
        <option value="04">April</option>
        <option value="05">May</option>
        <option value="06">June</option>
        <option value="07">July</option>
        <option value="08">August</option>
        <option value="09">September</option>
        <option value="10">October</option>
        <option value="11">November</option>
        <option value="12">December</option>
    </select>
    <div class="input-container ic1">

   

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="indiaDistrict.js"></script>
    <script src="indiaStates.js"></script>
    <script src="indiaRivers.js"></script>
    <script src="indiaBasin.js"></script>
    <script>
        // Get the dropdown menus
        const timescaleSelect = document.getElementById('timescale');
        const yearInput = document.getElementById('year');
        const monthSelect = document.getElementById('month');

        var imageOverlay; // Variable to store the current image overlay

        // Function to update the image path based on user selections
        function updateImagePath() {
            const timescale = timescaleSelect.value;
            const year = yearInput.value;
            const month = monthSelect.value;
            const imagePath = `${timescale}/${year}-${month}.png`;

            console.log(imagePath); // Log the updated image path

            // Update the image overlay on the map
            if (imageOverlay) {
                map.removeLayer(imageOverlay);
            }

            // Define the image bounds
            var imageBounds = [
                [1.3903893, 61.094], // Southwest corner (near Kanyakumari, Tamil Nadu)
                [39.951154, 103.856705] // Adjust the bounds to match your image
            ];

            imageOverlay = L.imageOverlay(imagePath, imageBounds);
            imageOverlay.setOpacity(0.6); // Adjust the opacity value
            imageOverlay.addTo(map);
        }

        // Add event listeners to the dropdown menus and input field
        timescaleSelect.addEventListener('change', updateImagePath);
        yearInput.addEventListener('input', updateImagePath);
        monthSelect.addEventListener('change', updateImagePath);

        // Initial map setup
        var map = L.map('map');

        // Add a base tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19
        }).addTo(map);

        // Define the bounds
        var bounds = [
            [8.753893, 68.162445], // Southwest corner (near Kanyakumari, Tamil Nadu)
            [39.513611, 97.395833] // Northeast corner (near Ledo, Arunachal Pradesh)
        ];

        map.zoomDelta = 0.25;
        map.zoomSnap = 0;

        // Set max and min zoom levels
        map.options.maxZoom = 50;
        map.options.minZoom = 4.31;

        // Set geographical boundaries for map panning
        map.setMaxBounds([[10, 98], [38, 68]]);

        // Disable zooming using the mouse wheel
        map.scrollWheelZoom.disable();

        // Fit the map to the bounds
        map.fitBounds(bounds);

        // Function to handle each feature (for districts)
        function onEachFeature(feature, layer) {
            // Example: Bind a popup
            layer.bindPopup(feature.properties.name);
        }

        // Create layers
        const statesLayer = L.geoJSON(indiastates, {
            style: {
                fillColor: 'none',
                weight: 2,
                color: 'black',
                interactive: false
            }
        });

        const districtsLayer = L.geoJSON(indiaDistrict, {
            style: {
                weight: 0.2,
                fillColor: "black",
                fillOpacity: 0.00001,
                color: 'black'
            },
            onEachFeature: onEachFeature
        });

        const basinsLayer = L.geoJSON(indiaBasin, {
            style: {
                fillColor: 'none',
                weight: 2,
                color: 'red',
                interactive: false
            }
        });

        const riversLayer = L.geoJSON(indiaRivers, {
            style: {
                fillColor: 'none',
                weight: 2,
                color: 'blue',
                interactive: false
            }
        });

        // Add layers to the map with layer control
        const overlayMaps = {
            "States Boundary": statesLayer,
            "District Boundary": districtsLayer,
            "River Basin Boundary": basinsLayer,
            "Rivers": riversLayer
        };

        L.control.layers(null, overlayMaps, { collapsed: false }).addTo(map);

        // By default, add the layers you want to be visible initially
        statesLayer.addTo(map);
        districtsLayer.addTo(map);

        // Add a mouseover event listener to the map
        map.on('mousemove', function(e) {
            // Get the coordinates of the mouse position
            var coord = e.latlng;

            // Create a popup with the coordinates
            var popup = L.popup()
                .setLatLng(coord)
                .setContent("Coordinates: " + coord.toString())
                .openOn(map);
        });

        // Add a mouseout event listener to the map to close the popup when the mouse leaves the map
        map.on('mouseout', function() {
            map.closePopup();
        });

        // Add the legend to the map
       /* var legend = L.control({ position: 'bottomright' });

        legend.onAdd = function(map) {
            var div = L.DomUtil.create('div', 'legend');
            var categories = ['Exceptional', 'Extreme', 'Severe', 'Moderate', 'Abnormal', 'Normal'];
            var colors = ['brown', 'red', 'orange', 'rgb(252, 214, 148)', 'yellow', 'white'];

            div.innerHTML += '<strong>Drought Categories</strong><br>';
            
            for (var i = 0; i < categories.length; i++) {
                div.innerHTML += '<i style="background:' + colors[i] + '"></i> ' + categories[i] + '<br>';
            }

            return div;
        };

        legend.addTo(map); */

        // Initial update of the image path
        updateImagePath();
    </script>
</body>
</html>
